<!DOCTYPE html><html><head><meta charset="utf-8"><title>Hands-on materials for NSF models.md</title><style></style></head><body id="preview">
<h1 class="code-line" data-line-start=0 data-line-end=1><a id="Handson_materials_for_NSF_models_0"></a>Hands-on materials for NSF models</h1>
<p class="has-line-data" data-line-start="2" data-line-end="3">Xin Wang, National Intitute of Informatics, 2020</p>
<h2 class="code-line" data-line-start=4 data-line-end=5><a id="1_Usage_4"></a>1. Usage</h2>
<p class="has-line-data" data-line-start="6" data-line-end="7">Readers may check the materials in this order:</p>
<ul>
<li class="has-line-data" data-line-start="7" data-line-end="9">
<p class="has-line-data" data-line-start="7" data-line-end="8"><strong>Part1</strong>: c*.ipynb. These notebooks explain the building blocks of NSF models with codes and figures;</p>
</li>
<li class="has-line-data" data-line-start="9" data-line-end="11">
<p class="has-line-data" data-line-start="9" data-line-end="10"><strong>Part2</strong>: s*.ipynb. These notebooks define NSF models using building blocks, load pre-trained models, and generate samples;</p>
</li>
<li class="has-line-data" data-line-start="11" data-line-end="13">
<p class="has-line-data" data-line-start="11" data-line-end="12"><strong>Part3</strong>: Pytorch scripts in <a href="https://github.com/nii-yamagishilab/project-NN-Pytorch-scripts">https://github.com/nii-yamagishilab/project-NN-Pytorch-scripts</a>. This part will show how to train NSF models on CMU-arctic database.</p>
</li>
<li class="has-line-data" data-line-start="13" data-line-end="14">
<p class="has-line-data" data-line-start="13" data-line-end="14"><strong>Hands-on-NSF</strong>.pdf: a brief doc. This is to be read while working on Part1, 2, and 3. It can be downloaded from <a href="https://www.dropbox.com/sh/gf3zp00qvdp3row/AADKGBaLfVSbQVEIEsRUw75Sa/web/pytorch-Hands-on-NSF_v202008.pdf?raw=1">here</a></p>
</li>
</ul>
<p class="has-line-data" data-line-start="16" data-line-end="17">Alternatively, readers may try this order:</p>
<ul>
<li class="has-line-data" data-line-start="17" data-line-end="19">
<p class="has-line-data" data-line-start="17" data-line-end="18"><strong>Part2</strong> s*.ipynb: play with pre-trained NSF models;</p>
</li>
<li class="has-line-data" data-line-start="19" data-line-end="21">
<p class="has-line-data" data-line-start="19" data-line-end="20"><strong>Part1</strong> c*.ipynb: go through the details of building blocks;</p>
</li>
<li class="has-line-data" data-line-start="21" data-line-end="23">
<p class="has-line-data" data-line-start="21" data-line-end="22"><strong>Part3</strong>: train NSF models on cmu-arctic using the Pytorch scripts.</p>
</li>
</ul>
<p class="has-line-data" data-line-start="23" data-line-end="24">Part1 and Part2 can be done on personal computer with web browsers and a few Python tools, no GPU is required.</p>
<p class="has-line-data" data-line-start="25" data-line-end="26">Part3 requires a Linux GPU server.</p>
<h2 class="code-line" data-line-start=28 data-line-end=29><a id="2_Work_on_Part_1_and_2_28"></a>2. Work on Part 1 and 2</h2>
<p class="has-line-data" data-line-start="29" data-line-end="30">Materials for part 1 and part 2 are written as Jupyter notebooks. Readers can open them on personal desktop or laptop.</p>
<h4 class="code-line" data-line-start=31 data-line-end=32><a id="21_Install_softwares_31"></a>2.1 Install softwares</h4>
<p class="has-line-data" data-line-start="33" data-line-end="34">To open and run Jupyter notebooks</p>
<ol>
<li class="has-line-data" data-line-start="34" data-line-end="35">Please use Python3</li>
<li class="has-line-data" data-line-start="35" data-line-end="36">Please install Jupyter notebook or Jupyter Lab <a href="https://jupyter.org/;">https://jupyter.org/;</a></li>
<li class="has-line-data" data-line-start="36" data-line-end="37">Please install pytorch (1.4 or later, cpu only), scipy (test on 1.4.1), numpy (test on 1.18.5), Matplotlib (test on 3.1.1);</li>
<li class="has-line-data" data-line-start="37" data-line-end="39">Optionally, <a href="https://librosa.org">librosa</a> is required to plot rainbow gram in s2_demonstration_music-nsf.ipynb.</li>
</ol>
<p class="has-line-data" data-line-start="39" data-line-end="40">If you use <a href="https://docs.conda.io/en/latest/miniconda.html">conda</a>, you may use <code>./env-cpu.yml</code> to install softwares and create a python environment:</p>
<pre><code class="has-line-data" data-line-start="42" data-line-end="44" class="language-sh">conda env create <span class="hljs-operator">-f</span> ./env-cpu.yml
</code></pre>
<p class="has-line-data" data-line-start="45" data-line-end="46">After restarting terminal, you can activate the python environment and run Jupyter lab</p>
<pre><code class="has-line-data" data-line-start="48" data-line-end="51" class="language-sh">conda activate pytorch-cpu
jupyter lab
</code></pre>
<h4 class="code-line" data-line-start=53 data-line-end=54><a id="22_Run_Jupyter_lab_53"></a>2.2 Run Jupyter lab</h4>
<p class="has-line-data" data-line-start="55" data-line-end="56">After installing required softwares, please open terminal to go to this directory. Then</p>
<pre><code class="has-line-data" data-line-start="58" data-line-end="60" class="language-sh">jupyter lab
</code></pre>
<p class="has-line-data" data-line-start="61" data-line-end="62">The browser will open, and you can click the jupyter notebooks and start to run it.</p>
<p class="has-line-data" data-line-start="63" data-line-end="64">If you are not familiar with Jupyter notebook, please check docs on this <a href="https://jupyter.org/">website</a>.</p>
<h4 class="code-line" data-line-start=65 data-line-end=66><a id="23_Use_HTML_files_65"></a>2.3 Use HTML files</h4>
<p class="has-line-data" data-line-start="67" data-line-end="68">If you don’t want to run Jupyter notebooks, please use any web browser to open the HTML files. HTML files are exported from Jupyter notebooks. They have the same contents as Jupyter notebooks.</p>
<h2 class="code-line" data-line-start=70 data-line-end=71><a id="3_Work_on_Part_3_70"></a>3. Work on Part 3</h2>
<p class="has-line-data" data-line-start="72" data-line-end="73">Part3 requires a Linux server with GPU card.</p>
<h4 class="code-line" data-line-start=74 data-line-end=75><a id="31_Install_softwares_74"></a>3.1 Install softwares</h4>
<ol>
<li class="has-line-data" data-line-start="75" data-line-end="76">Python3</li>
<li class="has-line-data" data-line-start="76" data-line-end="77">pytorch (1.4 or later) with GPU support</li>
<li class="has-line-data" data-line-start="77" data-line-end="79">scipy (test on 1.4.1), numpy (test on 1.18.5)</li>
</ol>
<p class="has-line-data" data-line-start="79" data-line-end="80">If <em>conda</em> is used to manage python environment, you may try this <a href="https://github.com/nii-yamagishilab/project-NN-Pytorch-scripts/blob/master/env.yml">env.yml</a> or this <a href="https://github.com/nii-yamagishilab/project-NN-Pytorch-scripts/blob/master/env2.yml">env2.yml</a> to create an environment called <em>pytorch-1.4</em>:</p>
<pre><code class="has-line-data" data-line-start="82" data-line-end="85" class="language-sh">conda env create <span class="hljs-operator">-f</span> env.yml
conda activate pytorch-<span class="hljs-number">1.4</span>
</code></pre>
<h4 class="code-line" data-line-start=86 data-line-end=87><a id="32_Run_script_86"></a>3.2 Run script</h4>
<ol>
<li class="has-line-data" data-line-start="87" data-line-end="88">Download script if you haven’t done so</li>
</ol>
<pre><code class="has-line-data" data-line-start="89" data-line-end="91" class="language-sh">git <span class="hljs-built_in">clone</span> https://github.com/nii-yamagishilab/project-NN-Pytorch-scripts
</code></pre>
<ol start="2">
<li class="has-line-data" data-line-start="93" data-line-end="94">Load installed Python environment (for example, pytorch-1.4 installed above)</li>
</ol>
<pre><code class="has-line-data" data-line-start="95" data-line-end="97">conda activate pytorch-1.4
</code></pre>
<ol start="3">
<li class="has-line-data" data-line-start="99" data-line-end="100">Run script in one project folder</li>
</ol>
<pre><code class="has-line-data" data-line-start="101" data-line-end="104" class="language-sh"><span class="hljs-built_in">cd</span> project/cyc-noise-nsf-<span class="hljs-number">4</span>
bash <span class="hljs-number">00</span>_demo.sh &gt; <span class="hljs-built_in">log</span>_train <span class="hljs-number">2</span>&gt;<span class="hljs-built_in">log</span>_err &amp;
</code></pre>
<p class="has-line-data" data-line-start="105" data-line-end="106">This 00_demo.sh will download CMU-arctic data, train one cyclic noise NSF model, and generate speech waveforms. The job will be running in background, and you can check log_train and log_err.</p>
<p class="has-line-data" data-line-start="107" data-line-end="108">It may take 1 or more days to finish.</p>
<p class="has-line-data" data-line-start="109" data-line-end="110">Please check Hands-on-NSF.pdf for details on Part3.</p>
<h3 class="code-line" data-line-start=112 data-line-end=113><a id="4_FAQ_112"></a>4. FAQ</h3>
<ol>
<li class="has-line-data" data-line-start="114" data-line-end="128">
<p class="has-line-data" data-line-start="114" data-line-end="115">Jupyter Lab cannot be opened in the browser</p>
<p class="has-line-data" data-line-start="116" data-line-end="117">If you a similar problem like <a href="https://github.com/jupyterlab/jupyterlab/issues/6921">this</a>, please change another browser.</p>
<p class="has-line-data" data-line-start="118" data-line-end="119">Simply copy the http address shown in the terminal that runs command Jupyter Lab and open it in another browser.</p>
<p class="has-line-data" data-line-start="120" data-line-end="121">The http address can be found in the terminal:</p>
<pre><code class="has-line-data" data-line-start="122" data-line-end="128">To access the notebook, open this file in a browser:
    file://...
or copy and paste one of these URLs:
   http://localhost:8888/...
or http://127.0.0.1:8888/...
</code></pre>
</li>
</ol>
<ol start="2">
<li class="has-line-data" data-line-start="130" data-line-end="135">
<p class="has-line-data" data-line-start="130" data-line-end="131">Jupyter Lab does not have the right kernel</p>
<p class="has-line-data" data-line-start="132" data-line-end="133">If you have installed Jupyter Lab before, you may not find the Python kernel corresponding to the newly created Python environment.</p>
<p class="has-line-data" data-line-start="134" data-line-end="135">Please check this <a href="https://ipython.readthedocs.io/en/stable/install/kernel_install.html#kernels-for-different-environments">page</a> to add the kernel to Jupyter Lab.</p>
</li>
</ol>
</body></html>
